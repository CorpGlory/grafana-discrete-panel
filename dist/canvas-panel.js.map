{"version":3,"sources":["../src/canvas-panel.js"],"names":["MetricsPanelCtrl","appEvents","_","moment","CanvasPanelCtrl","$scope","$injector","$q","q","data","mouse","position","down","$tooltip","$","events","on","onPanelInitalized","bind","onRefresh","onRender","_devicePixelRatio","window","devicePixelRatio","undefined","render","context","console","log","rect","wrap","getBoundingClientRect","height","Math","max","width","canvas","centerV","ctx","lineWidth","textBaseline","time","dashboard","formatDate","ts","fillStyle","fillRect","font","textAlign","fillText","xmin","min","x","xmax","globalCompositeOperation","beginPath","fill","strokeStyle","moveTo","lineTo","stroke","detach","evt","elapsed","range","to","from","offsetX","parseFloat","y","clientY","top","yRel","showTT","isExternal","where","scope","elem","attrs","ctrl","find","document","createElement","appendChild","css","getContext","addEventListener","getMousePosition","info","pos","pageX","pageY","panelRelY","panelRelX","xRel","panel","emit","clearTT","buttons","up","onMouseClicked","utc","onMouseSelectedRange","isThis","event","id","sharedTooltipModeEnabled","otherPanelInFullscreenMode","gevt","onGraphHover","sharedCrosshairModeOnly"],"mappings":"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","file":"canvas-panel.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\n\nimport appEvents from 'app/core/app_events';\n\nimport _ from 'lodash';\nimport moment from 'moment';\n\n\n// Expects a template with:\n// <div class=\"canvas-spot\"></div>\nexport class CanvasPanelCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector);\n\n    this.q = $q;\n    this.data = null;\n    this.mouse = {\n      position: null,\n      down: null,\n    };\n\n    this.$tooltip = $('<div class=\"graph-tooltip\">');\n\n    this.events.on('panel-initialized', this.onPanelInitalized.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n\n    this._devicePixelRatio = 1;\n    if(window.devicePixelRatio !== undefined) {\n      this._devicePixelRatio = window.devicePixelRatio;\n    }\n\n  }\n\n  onPanelInitalized() {\n    //console.log(\"onPanelInitalized()\");\n    this.render();\n  }\n\n  onRefresh() {\n    this.render();\n  }\n\n  // Typically you will override this\n  onRender() {\n    if(!(this.context)) {\n      console.log('No context!');\n      return;\n    }\n    console.log('canvas render', this.mouse);\n\n    var rect = this.wrap.getBoundingClientRect();\n\n    var height = Math.max(this.height, 100);\n    var width = rect.width;\n    this.canvas.width = width;\n    this.canvas.height = height;\n\n    var centerV = height / 2;\n\n    var ctx = this.context;\n    ctx.lineWidth = 1;\n    ctx.textBaseline = 'middle';\n\n    var time = \"\";\n    if(this.mouse.position != null) {\n      time = this.dashboard.formatDate(moment(this.mouse.position.ts));\n    }\n\n    ctx.fillStyle = '#999999';\n    ctx.fillRect(0, 0, width, height);\n    ctx.fillStyle = \"#111111\";\n    ctx.font = '24px \"Open Sans\", Helvetica, Arial, sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText(\"Mouse @ \" + time, 10, centerV);\n\n    if(this.mouse.position != null ) {\n      if(this.mouse.down != null) {\n        var xmin = Math.min(this.mouse.position.x, this.mouse.down.x);\n        var xmax = Math.max(this.mouse.position.x, this.mouse.down.x);\n\n        // Fill canvas using 'destination-out' and alpha at 0.05\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n        ctx.beginPath();\n        ctx.fillRect(0, 0, xmin, height);\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.fillRect(xmax, 0, width, height);\n        ctx.fill();\n        ctx.globalCompositeOperation = 'source-over';\n      } else {\n        ctx.strokeStyle = '#111';\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.strokeStyle = '#e22c14';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n      }\n    }\n  }\n\n  clearTT() {\n    this.$tooltip.detach();\n  }\n\n  getMousePosition(evt) {\n    var elapsed = this.range.to - this.range.from;\n    var rect = this.canvas.getBoundingClientRect();\n    var x = evt.offsetX; // - rect.left;\n    var ts = this.range.from + (elapsed * (x / parseFloat(rect.width)));\n    var y = evt.clientY - rect.top;\n\n    return {\n      x: x,\n      y: y,\n      yRel: y / parseFloat(rect.height),\n      ts: ts,\n      evt: evt\n    };\n  }\n\n  onGraphHover(evt, showTT, isExternal) {\n    console.log(\"HOVER\", evt, showTT, isExternal);\n  }\n\n  onMouseClicked(where) {\n    console.log(\"CANVAS CLICKED\", where);\n    this.render();\n  }\n\n  onMouseSelectedRange(range) {\n    console.log(\"CANVAS Range\", range);\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.wrap = elem.find('.canvas-spot')[0];\n    this.canvas = document.createElement(\"canvas\");\n    this.wrap.appendChild(this.canvas);\n\n    $(this.canvas).css('cursor', 'pointer');\n    $(this.wrap).css('width', '100%');\n\n    this.context = this.canvas.getContext('2d');\n\n    this.canvas.addEventListener('mousemove', evt => {\n      this.mouse.position = this.getMousePosition(evt);\n      var info = {\n        pos: {\n          pageX: evt.pageX,\n          pageY: evt.pageY,\n          x: this.mouse.position.ts,\n          y: this.mouse.position.y,\n          panelRelY: this.mouse.position.yRel,\n          panelRelX: this.mouse.position.xRel\n        },\n        evt: evt,\n        panel: this.panel\n      };\n      appEvents.emit('graph-hover', info);\n      if(this.mouse.down != null) {\n        $(this.canvas).css('cursor', 'col-resize');\n      }\n    }, false);\n\n    this.canvas.addEventListener('mouseout', evt => {\n      if(this.mouse.down == null) {\n        this.mouse.position = null;\n        this.onRender();\n        this.clearTT();\n        appEvents.emit('graph-hover-clear');\n      }\n    }, false);\n\n    this.canvas.addEventListener('mousedown', evt => {\n      this.mouse.down = this.getMousePosition(evt);\n    }, false);\n\n    this.canvas.addEventListener('mouseenter', evt => {\n      if(this.mouse.down && !evt.buttons) {\n        this.mouse.position = null;\n        this.mouse.down = null;\n        this.onRender();\n        this.clearTT();\n        appEvents.emit('graph-hover-clear');\n      }\n      $(this.canvas).css('cursor', 'pointer');\n    }, false);\n\n    this.canvas.addEventListener('mouseup', evt => {\n      this.clearTT();\n      var up = this.getMousePosition(evt);\n      if(this.mouse.down != null) {\n        if(up.x == this.mouse.down.x && up.y == this.mouse.down.y) {\n          this.mouse.position = null;\n          this.mouse.down = null;\n          this.onMouseClicked(up);\n        } else {\n          var min = Math.min(this.mouse.down.ts, up.ts);\n          var max = Math.max(this.mouse.down.ts, up.ts);\n          var range = { from: moment.utc(min), to: moment.utc(max) };\n          this.mouse.position = up;\n          this.onMouseSelectedRange(range);\n        }\n      }\n      this.mouse.down = null;\n      this.mouse.position = null;\n    }, false);\n\n    this.canvas.addEventListener('dblclick', evt => {\n      this.mouse.position = null;\n      this.mouse.down = null;\n      this.onRender();\n      this.clearTT();\n      appEvents.emit('graph-hover-clear');\n\n      console.log('TODO, ZOOM OUT');\n\n    }, true);\n\n    // global events\n    appEvents.on('graph-hover', event => {\n\n      // ignore other graph hover events if shared tooltip is disabled\n      var isThis = event.panel.id === this.panel.id;\n      if (!this.dashboard.sharedTooltipModeEnabled() && !isThis) {\n        return;\n      }\n\n      // ignore if other panels are fullscreen\n      if (this.otherPanelInFullscreenMode()) {\n        return;\n      }\n\n      // Calculate the mouse position when it came from somewhere else\n      if(!isThis) {\n        if(!event.pos.x) {\n          console.log(\"Invalid hover point\", event);\n          return;\n        }\n\n        var ts = event.pos.x;\n        var rect = this.canvas.getBoundingClientRect();\n        var elapsed = parseFloat(this.range.to - this.range.from);\n        var x = ((ts - this.range.from) / elapsed) * rect.width;\n\n        this.mouse.position = {\n          x: x,\n          y: event.pos.panelRelY * rect.height,\n          yRel: event.pos.panelRelY,\n          ts: ts,\n          gevt: event\n        };\n\n      }\n\n      this.onGraphHover(event, isThis || !this.dashboard.sharedCrosshairModeOnly(), !isThis);\n    }, scope);\n\n    appEvents.on('graph-hover-clear', (event, info) => {\n      this.mouse.position = null;\n      this.mouse.down = null;\n      this.render();\n      this.clearTT();\n    }, scope);\n\n  }\n}\n\n"]}