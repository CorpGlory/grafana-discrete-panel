{"version":3,"sources":["../src/module.js"],"names":["CanvasPanelCtrl","DistinctPoints","config","appEvents","kbn","_","moment","angular","DiscretePanelCtrl","$scope","$injector","$q","data","panelDefaults","display","rowHeight","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","colorMaps","color","tooltip","highlightOnMouseover","shared","sort","metricNameColor","valueTextColor","backgroundColor","lineColor","textSize","writeLastValue","writeAllValues","writeMetricNames","showLegend","showLegendNames","showLegendValues","showLegendPercent","legendSortBy","defaults","panel","externalPT","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onRefresh","updateColorInfo","onConfigChanged","err","console","log","addEditorTab","editorTabIndex","refresh","context","rect","wrap","getBoundingClientRect","rows","length","height","width","canvas","ctx","lineWidth","textBaseline","font","top","elapsed","range","forEach","centerV","fillStyle","fillRect","isTimeline","lastBS","point","metric","changes","i","start","xt","Math","max","x","getColor","val","textAlign","fillText","legendInfo","ms","strokeStyle","beginPath","moveTo","lineTo","stroke","mouse","position","down","next","ts","globalCompositeOperation","fill","xmin","min","xmax","arc","y","PI","pos","infos","selectedIndex","Number","isInteger","Error","body","each","info","isLast","count","duration","humanize","$tooltip","html","place_tt","pageX","pageY","evt","isExternal","time","dashboard","formatDate","panelRelY","$","window","innerHeight","clearTT","scrollTop","pX","left","points","Array","isArray","curTime","stats","isNumber","map","parseFloat","isNull","isNil","isString","toString","has","colorMap","palet","abs","hashCode","letters","split","floor","random","str","hash","char","charCodeAt","datasource","targets","when","scopedVars","Object","assign","interval","intervalMs","rangeRaw","expandFromQueryS","clone","subtract","format","metricsQuery","panelId","id","renderer","maxDataPoints","resolution","cacheTimeout","query","dataList","css","type","columns","last","res","j","row","add","formatValue","finish","push","target","datapoints","index","indexOf","splice","cm","m","render","what","randomColor","rangeMap","disp","showLegendCounts","showLegendTime","hassomething","dec","legendPercentDecimals","per","valueFormats","percentunit","clamp","items","undefined","selected","showTT","showTooltip","_getRowsToHover","js","hovers","hover","showTooltips","showStackedTooltips","where","pt","utc","timeSrv","setTime","clear","emit","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import { CanvasPanelCtrl } from './canvas-metric';\nimport { DistinctPoints } from './points';\n\nimport config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport moment from 'moment';\nimport angular from 'angular';\n\n\nclass DiscretePanelCtrl extends CanvasPanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector, $q);\n\n    this.data = null;\n\n    // Set and populate defaults\n    var panelDefaults = {\n      display: 'timeline',\n      rowHeight: 50,\n      valueMaps: [\n        { value: 'null', op: '=', text: 'N/A' }\n      ],\n      mappingTypes: [\n        { name: 'value to text', value: 1 },\n        { name: 'range to text', value: 2 },\n      ],\n      rangeMaps: [\n        { from: 'null', to: 'null', text: 'N/A' }\n      ],\n      colorMaps: [\n        { text: 'N/A', color: '#CCC' }\n      ],\n      tooltip: {\n        highlightOnMouseover: true,\n        shared: true,\n        sort: 0\n      },\n      metricNameColor: '#000000',\n      valueTextColor: '#000000',\n      backgroundColor: 'rgba(128, 128, 128, 0.1)',\n      lineColor: 'rgba(128, 128, 128, 1.0)',\n      textSize: 24,\n      writeLastValue: true,\n      writeAllValues: false,\n      writeMetricNames: false,\n      showLegend: true,\n      showLegendNames: true,\n      showLegendValues: true,\n      showLegendPercent: true,\n      legendSortBy: '-ms'\n    };\n\n    _.defaults(this.panel, panelDefaults);\n    this.externalPT = false;\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n\n    this.updateColorInfo();\n    this.onConfigChanged();\n  }\n\n  onDataError(err) {\n    console.log(\"onDataError\", err);\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/natel-discrete-panel/editor.options.html',1);\n    this.addEditorTab('Legend', 'public/plugins/natel-discrete-panel/editor.legend.html',3);\n    this.addEditorTab('Colors', 'public/plugins/natel-discrete-panel/editor.colors.html',4);\n    this.addEditorTab('Mappings', 'public/plugins/natel-discrete-panel/editor.mappings.html', 5);\n    this.editorTabIndex = 1;\n    this.refresh();\n  }\n\n  onRender() {\n\n    if(this.data == null || !(this.context)) {\n      return;\n    }\n\n    var rect = this.wrap.getBoundingClientRect();\n\n    var rows = this.data.length;\n    var rowHeight = this.panel.rowHeight;\n\n    var height = rowHeight * rows;\n    var width = rect.width;\n    this.canvas.width = width;\n    this.canvas.height = height;\n\n    var ctx = this.context;\n    ctx.lineWidth = 1;\n    ctx.textBaseline = 'middle';\n    ctx.font = this.panel.textSize + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n\n    // ctx.shadowOffsetX = 1;\n    // ctx.shadowOffsetY = 1;\n    // ctx.shadowColor = \"rgba(0,0,0,0.3)\";\n    // ctx.shadowBlur = 3;\n\n    var top = 0;\n\n    var elapsed = this.range.to - this.range.from;\n\n    _.forEach(this.data, metric => {\n      var centerV = top + (rowHeight / 2);\n\n      // The no-data line\n      ctx.fillStyle = this.panel.backgroundColor;\n      ctx.fillRect(0, top, width, rowHeight);\n\n      /*if(!this.panel.writeMetricNames) {\n        ctx.fillStyle = \"#111111\";\n        ctx.textAlign = 'left';\n        ctx.fillText(\"No Data\", 10, centerV);\n      }*/\n      if(this.isTimeline) {\n        var lastBS = 0;\n        var point = metric.changes[0];\n        for(var i = 0; i < metric.changes.length; i++) {\n          point = metric.changes[i];\n          if(point.start <= this.range.to) {\n            var xt = Math.max(point.start - this.range.from, 0);\n            point.x = (xt / elapsed) * width;\n            ctx.fillStyle = this.getColor(point.val);\n            ctx.fillRect(point.x, top, width, rowHeight);\n\n            if(this.panel.writeAllValues) {\n              ctx.fillStyle = this.panel.valueTextColor;\n              ctx.textAlign = 'left';\n              ctx.fillText(point.val, point.x + 7, centerV);\n            }\n            lastBS = point.x;\n          }\n        }\n      } else if(this.panel.display == 'stacked') {\n        var point = null;\n        var start = this.range.from;\n        for(var i = 0; i < metric.legendInfo.length; i++) {\n          point = metric.legendInfo[i];\n\n          var xt = Math.max(start - this.range.from, 0);\n          point.x = (xt / elapsed) * width;\n          ctx.fillStyle = this.getColor(point.val);\n          ctx.fillRect(point.x, top, width, rowHeight);\n\n          if(this.panel.writeAllValues) {\n            ctx.fillStyle = this.panel.valueTextColor;\n            ctx.textAlign = 'left';\n            ctx.fillText(point.val, point.x+7, centerV);\n          }\n\n          start += point.ms;\n        }\n      } else {\n        console.log(\"Not supported yet...\", this);\n      }\n\n      if(top > 0) {\n        ctx.strokeStyle = this.panel.lineColor;\n        ctx.beginPath();\n        ctx.moveTo(0, top);\n        ctx.lineTo(width, top);\n        ctx.stroke();\n      }\n\n      ctx.fillStyle = \"#000000\";\n\n      if(\n        this.panel.writeMetricNames &&\n        this.mouse.position == null\n      ) {\n        ctx.fillStyle = this.panel.metricNameColor;\n        ctx.textAlign = 'left';\n        ctx.fillText(metric.name, 10, centerV);\n      }\n\n      ctx.textAlign = 'right';\n\n      if(this.mouse.down == null) {\n        if(this.panel.tooltip.highlightOnMouseover && this.mouse.position != null) {\n          var next = null;\n\n          if(this.isTimeline) {\n            point = metric.changes[0];\n            for(var i = 0; i < metric.changes.length; i++) {\n              if(metric.changes[i].start > this.mouse.position.ts) {\n                next = metric.changes[i];\n                break;\n              }\n              point = metric.changes[i];\n            }\n          } else if(this.panel.display == 'stacked') {\n            point = metric.legendInfo[0];\n            for(var i=0; i<metric.legendInfo.length; i++) {\n              if(metric.legendInfo[i].x > this.mouse.position.x) {\n                next = metric.legendInfo[i];\n                break;\n              }\n              point = metric.legendInfo[i];\n            }\n          }\n\n          // Fill canvas using 'destination-out' and alpha at 0.05\n          ctx.globalCompositeOperation = 'destination-out';\n          ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\n          ctx.beginPath();\n          ctx.fillRect(0, top, point.x, rowHeight);\n          ctx.fill();\n\n          if(next != null) {\n            ctx.beginPath();\n            ctx.fillRect(next.x, top, width, rowHeight);\n            ctx.fill();\n          }\n          ctx.globalCompositeOperation = 'source-over';\n\n          // Now Draw the value\n          ctx.fillStyle = \"#000000\";\n          ctx.textAlign = 'left';\n          ctx.fillText(point.val, point.x + 7, centerV);\n        } else if(this.panel.writeLastValue) {\n          ctx.fillText(point.val, width - 7, centerV);\n        }\n      }\n\n      top += rowHeight;\n    });\n\n    if(this.isTimeline && this.mouse.position != null) {\n      if(this.mouse.down != null) {\n        var xmin = Math.min(this.mouse.position.x, this.mouse.down.x);\n        var xmax = Math.max(this.mouse.position.x, this.mouse.down.x);\n\n        // Fill canvas using 'destination-out' and alpha at 0.05\n        ctx.globalCompositeOperation = 'destination-out';\n        ctx.fillStyle = \"rgba(255, 255, 255, 0.6)\";\n        ctx.beginPath();\n        ctx.fillRect(0, 0, xmin, height);\n        ctx.fill();\n\n        ctx.beginPath();\n        ctx.fillRect(xmax, 0, width, height);\n        ctx.fill();\n        ctx.globalCompositeOperation = 'source-over';\n      } else {\n        ctx.strokeStyle = '#111';\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.lineWidth = 3;\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.moveTo(this.mouse.position.x, 0);\n        ctx.lineTo(this.mouse.position.x, height);\n        ctx.strokeStyle = '#e22c14';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n        if(this.externalPT && rows > 1) {\n          ctx.beginPath();\n          ctx.arc(this.mouse.position.x, this.mouse.position.y, 3, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#e22c14';\n          ctx.fill();\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = '#111';\n          ctx.stroke();\n        }\n      }\n    }\n  }\n\n  showStackedTooltips(pos, infos, selectedIndex) {\n\n    if(!Number.isInteger(selectedIndex)) {\n      throw new Error('selectedIndex must integer');\n    }\n\n    var body = \"\";\n    _.each(infos, (info, i) => {    \n      var isLast = (i + 1) == infos.length;\n\n      body += '<div class=\"graph-tooltip-time\">'+ info.val +'</div>';\n      body += \"<center>\";\n      if(info.count > 1) {\n        body += info.count + \" times<br/>for<br/>\";\n      }\n      body += moment.duration(info.ms).humanize();\n      if(info.count > 1) {\n        body += \"<br/>total\";\n      }\n      body += \"</center>\";\n      if(!isLast) {\n        body += \"<hr>\";\n      }\n    });\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  showTooltip(evt, point, isExternal) {\n    \n    var from = point.start;\n    var to = point.start + point.ms;\n    var time = point.ms;\n    var val = point.val;\n\n    body += '<div class=\"graph-tooltip-time\">' + val + '</div>';\n\n    body += \"<center>\"\n    body += this.dashboard.formatDate(moment(from));\n    body += \" to \";\n    body += this.dashboard.formatDate(moment(to));\n    body += \" (\" + moment.duration(time).humanize() + \")\";\n    body += \"</center>\"\n    \n    var pageX = 0;\n    var pageY = 0;\n    if(isExternal) {\n      var rect = this.canvas.getBoundingClientRect();\n      pageY = rect.top + (evt.pos.panelRelY * rect.height);\n      if(pageY < 0 || pageY > $(window).innerHeight()) {\n        // Skip Hidden tooltip\n        this.clearTT();\n        return;\n      }\n      pageY += $(window).scrollTop();\n\n      var elapsed = this.range.to - this.range.from;\n      var pX = (evt.pos.x - this.range.from) / elapsed;\n      pageX = rect.left + (pX * rect.width);\n    } else {\n      pageX = evt.evt.pageX;\n      pageY = evt.evt.pageY;\n    }\n\n    this.$tooltip.html(body).place_tt(pageX + 20, pageY + 5);\n  };\n\n  showTooltips(evt, points, selectedIndex, isExternal) {\n\n    if(!Array.isArray(points)) {\n      throw new Error('Not array provided');\n    }\n\n    if(!Number.isInteger(selectedIndex)) {\n      throw new Error('selectedIndex must be integer');\n    }\n\n    var curTime = this.dashboard.formatDate(moment(this.mouse.position.ts));\n\n    var body = `<div class=\"graph-tooltip-time\"> ${curTime} </div>`;\n    \n    _.each(points, (point, i) => {\n\n      var from = point.start;\n      var to = point.start + point.ms;\n      var time = point.ms;\n      var val = point.val;\n\n      var color = this.getColor(val);\n\n      body += `\n      <div \n        class=\"\n          graph-tooltip-list-item \n          ${i == selectedIndex ? 'graph-tooltip-list-item--highlight' : ''}\n        \"\n      >\n        <div class=\"graph-tooltip-series-name\">\n          <i class=\"fa fa-minus\" style=\"color:${color}\"></i>\n          ${ val }\n        </div>\n        <div class=\"graph-tooltip-value\">\n          ${this.dashboard.formatDate(moment(from))}\n          to\n          ${this.dashboard.formatDate(moment(to))}\n          (${moment.duration(time).humanize()});\n        </div>\n      </div>\n      `;\n    });\n    \n    var pageX = 0;\n    var pageY = 0;\n    if(isExternal) {\n      var rect = this.canvas.getBoundingClientRect();\n      pageY = rect.top + (evt.pos.panelRelY * rect.height);\n      if(pageY < 0 || pageY > $(window).innerHeight()) {\n        // Skip Hidden tooltip\n        this.clearTT();\n        return;\n      }\n      pageY += $(window).scrollTop();\n\n      var elapsed = this.range.to - this.range.from;\n      var pX = (evt.pos.x - this.range.from) / elapsed;\n      pageX = rect.left + (pX * rect.width);\n    } else {\n      pageX = evt.evt.pageX;\n      pageY = evt.evt.pageY;\n    }\n\n    this.$tooltip.html(body).place_tt(pageX + 20, pageY + 5);\n\n  }\n\n  formatValue(val, stats) {\n\n    if(_.isNumber(val) && this.panel.rangeMaps) {\n      for (var i = 0; i < this.panel.rangeMaps.length; i++) {\n        var map = this.panel.rangeMaps[i];\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= val && from <= val) {\n          return map.text;\n        }\n      }\n    }\n\n    var isNull = _.isNil(val);\n    if(!isNull && !_.isString(val)) {\n      val = val.toString(); // convert everything to a string\n    }\n\n    for (var i = 0; i < this.panel.valueMaps.length; i++) {\n      var map = this.panel.valueMaps[i];\n      // special null case\n      if (map.value === 'null') {\n        if (isNull) {\n          return map.text;\n        }\n        continue;\n      }\n\n      if(val == map.value) {\n        return map.text;\n      }\n    }\n\n    if(isNull) {\n      return \"null\";\n    }\n    return val;\n  }\n\n  getColor(val) {\n    if(_.has(this.colorMap, val)) {\n      return this.colorMap[val];\n    }\n\n    var palet = [\n      '#FF4444',\n      '#9933CC',\n      '#32D1DF',\n      '#ed2e18',\n      '#CC3900',\n      '#F79520',\n      '#33B5E5'\n    ];\n\n    return palet[Math.abs(this.hashCode(val + '')) % palet.length];\n  }\n\n  randomColor() {\n    var letters = 'ABCDE'.split('');\n    var color = '#';\n    for (var i=0; i<3; i++ ) {\n        color += letters[Math.floor(Math.random() * letters.length)];\n    }\n    return color;\n  }\n\n  hashCode(str){\n    var hash = 0;\n    if (str.length == 0) return hash;\n    for (var i = 0; i < str.length; i++) {\n      var char = str.charCodeAt(i);\n      hash = ((hash<<5)-hash)+char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n\n  // Copied from Metrics Panel, only used to expand the 'from' query\n  issueQueries(datasource) {\n    this.datasource = datasource;\n\n    if (!this.panel.targets || this.panel.targets.length === 0) {\n      return this.$q.when([]);\n    }\n\n    // make shallow copy of scoped vars,\n    // and add built in variables interval and interval_ms\n    var scopedVars = Object.assign({}, this.panel.scopedVars, {\n      \"__interval\":     {text: this.interval,   value: this.interval},\n      \"__interval_ms\":  {text: this.intervalMs, value: this.intervalMs},\n    });\n\n    var range = this.range;\n    var rangeRaw = this.rangeRaw;\n    if(this.panel.expandFromQueryS > 0) {\n      range = {\n        from: this.range.from.clone(),\n        to: this.range.to\n      };\n      range.from.subtract( this.panel.expandFromQueryS, 's' );\n\n      rangeRaw = {\n        from: range.from.format(),\n        to: this.rangeRaw.to\n      };\n    }\n\n    var metricsQuery = {\n      panelId: this.panel.id,\n      range: range,\n      rangeRaw: rangeRaw,\n      interval: this.interval,\n      intervalMs: this.intervalMs,\n      targets: this.panel.targets,\n      format: this.panel.renderer === 'png' ? 'png' : 'json',\n      maxDataPoints: this.resolution,\n      scopedVars: scopedVars,\n      cacheTimeout: this.panel.cacheTimeout\n    };\n\n    return datasource.query(metricsQuery);\n  }\n\n  onDataReceived(dataList) {\n    $(this.canvas).css( 'cursor', 'pointer' );\n\n    var data = [];\n    _.forEach(dataList, (metric) => {\n      if('table'=== metric.type) {\n        if('time' != metric.columns[0].type) {\n          throw 'Expected a time column from the table format';\n        }\n\n        var last = null;\n        for(var i=1; i<metric.columns.length; i++) {\n          var res = new DistinctPoints(metric.columns[i].text);\n          for(var j=0; j<metric.rows.length; j++) {\n            var row = metric.rows[j];\n            res.add( row[0], this.formatValue( row[i] ) );\n          }\n          res.finish( this );\n          data.push( res );\n        }\n      }\n      else {\n        var res = new DistinctPoints( metric.target );\n        _.forEach(metric.datapoints, (point) => {\n          res.add( point[1], this.formatValue(point[0]) );\n        });\n        res.finish( this );\n        data.push( res );\n      }\n    });\n    this.data = data;\n\n    this.onRender();\n\n    //console.log( 'data', dataList, this.data);\n  }\n\n  removeColorMap(map) {\n    var index = _.indexOf(this.panel.colorMaps, map);\n    this.panel.colorMaps.splice(index, 1);\n    this.updateColorInfo();\n  };\n\n  updateColorInfo() {\n    var cm = {};\n    for(var i=0; i<this.panel.colorMaps.length; i++) {\n      var m = this.panel.colorMaps[i];\n      if(m.text) {\n        cm[m.text] = m.color;\n      }\n    }\n    this.colorMap = cm;\n    this.render();\n  }\n\n  addColorMap(what) {\n    if(what == 'curent') {\n      _.forEach(this.data, (metric) => {\n        if(metric.legendInfo) {\n          _.forEach(metric.legendInfo, (info) => {\n            if(!_.has(info.val)) {\n              this.panel.colorMaps.push({text: info.val, color: this.getColor(info.val) });\n            }\n          });\n        }\n      });\n    }\n    else {\n      this.panel.colorMaps.push({text: '???', color: this.randomColor() });\n    }\n    this.updateColorInfo();\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  };\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  };\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({from: '', to: '', text: ''});\n  }\n\n  onConfigChanged() {\n    //console.log( \"Config changed...\");\n    this.isTimeline = this.panel.display == 'timeline';\n    this.render();\n  }\n\n  getLegendDisplay(info, metric) {\n    var disp = info.val;\n    if(this.panel.showLegendPercent || this.panel.showLegendCounts || this.panel.showLegendTime) {\n      disp += \" (\";\n      var hassomething = false;\n      if(this.panel.showLegendTime) {\n        disp += moment.duration(info.ms).humanize();\n        hassomething = true;\n      }\n\n      if(this.panel.showLegendPercent) {\n        if(hassomething) {\n          disp += \", \";\n        }\n\n        var dec = this.panel.legendPercentDecimals;\n        if(_.isNil(dec)) {\n          if(info.per>.98 && metric.changes.length>1) {\n            dec = 2;\n          }\n          else if(info.per<0.02) {\n            dec = 2;\n          }\n          else {\n            dec = 0;\n          }\n        }\n        disp += kbn.valueFormats.percentunit(info.per, dec);\n        hassomething = true;\n      }\n\n      if(this.panel.showLegendCounts) {\n        if(hassomething) {\n          disp += \", \";\n        }\n        disp += info.count+\"x\";\n      }\n      disp += \")\";\n    }\n    return disp;\n  }\n\n  //------------------\n  // Mouse Events\n  //------------------\n\n  _getRowsToHover() {\n    var j = Math.floor(this.mouse.position.y / this.panel.rowHeight);\n    j = _.clamp(j, 0, this.data.length - 1);\n    var items = undefined;\n\n    if(this.panel.tooltip.shared) {\n      items = _.range(0, this.data.length);\n    } else {\n      items = [j];\n    }\n\n    return {\n      items: items,\n      selected: j\n    }\n  }\n\n  onGraphHover(evt, showTT, isExternal) {\n    this.externalPT = isExternal;\n    if(!this.data) {\n      this.clearTT(); // make sure it is hidden\n      this.onRender(); // refresh the view\n      return;\n    }\n\n    if(this.mouse.down != null) {\n      var from = Math.min(this.mouse.down.ts, this.mouse.position.ts);\n      var to   = Math.max(this.mouse.down.ts, this.mouse.position.ts);\n      var time = to - from;\n      \n      var point = {\n        start: from,\n        ms: time,\n        val: \"Zoom To:\" \n      };\n\n      this.showTooltip(evt, point, isExternal);\n      this.onRender(); // refresh the view\n      return;\n    }\n\n    if(!showTT) {\n      this.onRender();\n      return;\n    }\n    \n    var { items: js, selected } = this._getRowsToHover();\n    \n    if(this.isTimeline) {\n      var hovers = [];\n      _.each(js, j => {\n        var hover = this.data[j].changes[0];\n        for(var i = 0; i < this.data[j].changes.length; i++) {\n          if(this.data[j].changes[i].start > this.mouse.position.ts) {\n            break;\n          }\n          hover = this.data[j].changes[i];\n        }\n        hovers.push(hover);\n      });\n      \n      this.showTooltips(evt, hovers, selected, isExternal);\n      this.onRender();\n      return;\n    }\n\n    if(!isExternal && this.panel.display == 'stacked') {\n      var hovers = [];\n      _.each(js, j => {\n        var hover = this.data[j].legendInfo[0];\n        for(var i = 0; i < this.data[j].legendInfo.length; i++) {\n          if(this.data[j].legendInfo[i].x > this.mouse.position.x) {\n            break;\n          }\n          hover = this.data[j].legendInfo[i];\n        }\n        hovers.push(hover);\n      });\n\n      this.showStackedTooltips(evt.evt, hovers, selected);\n      this.onRender();\n      return;\n    }\n\n  }\n\n  onMouseClicked(where) {\n    if(pt && pt.start) {\n      var range = { from: moment.utc(pt.start), to: moment.utc(pt.start + pt.ms) };\n      this.timeSrv.setTime(range);\n      this.clear();\n    }\n  }\n\n  onMouseSelectedRange(range) {\n    this.timeSrv.setTime(range);\n    this.clear();\n  }\n\n  clear() {\n    this.mouse.position = null;\n    this.mouse.down = null;\n    $(this.canvas).css('cursor', 'wait');\n    appEvents.emit('graph-hover-clear');\n    this.render();\n  }\n}\n\nDiscretePanelCtrl.templateUrl = 'module.html';\n\nexport { DiscretePanelCtrl as PanelCtrl };\n"]}