{"version":3,"sources":["../src/module.js"],"names":["CanvasPanelCtrl","DistinctPoints","mobileAndTabletcheck","grafanaColors","config","appEvents","kbn","_","moment","angular","DiscretePanelCtrl","$scope","$injector","$q","data","panelDefaults","display","rowHeight","rowMargin","valueMaps","value","op","text","mappingTypes","name","rangeMaps","from","to","colorMaps","color","tooltip","highlightOnMouseover","shared","sort","legend","show","showPercent","showNames","showValues","showTransitionCount","showDistinctCount","showCounts","showTime","sortBy","layoutMode","percentDecimals","undefined","textSize","metricNameColor","valueTextColor","backgroundColor","lineColor","crosshairColor","textPadding","writeLastValue","writeAllValues","writeMetricNames","defaultsDeep","panel","externalPT","events","on","onInitEditMode","bind","onRender","onDataReceived","onDataError","onRefresh","updateColorInfo","onConfigChanged","initStyles","System","import","panelPath","err","console","log","addEditorTab","editorTabIndex","refresh","x","y","w","h","ctx","context","tempComposition","globalCompositeOperation","tempFillStyle","fillStyle","beginPath","fillRect","fill","_renderDimenstions","rect","wrap","getBoundingClientRect","rows","length","height","width","rectHeight","top","elapsed","range","matrix","forEach","positions","isTimeline","lastBS","point","metric","changes","i","start","xt","Math","max","push","isStacked","legendInfo","ms","selectionPredicates","all","crosshairHover","j","mouse","position","ts","mouseX","row","_selectedMetric","legendItem","_selectedLegendItem","val","_getVal","getPridicate","down","pn","predicate","_selectionMatrix","rs","r","metricIndex","rectIndex","canvas","_devicePixelRatio","$","css","scale","rowObj","currentX","nextX","getColor","globalAlphaTemp","globalAlpha","LEBELS_PADDING","lineWidth","textBaseline","font","findLength","testLine","substr","measure","measureText","centerV","labelPositionMetricName","labelPositionLastValue","labelPositionValue","textAlign","fillText","_getWidth","cval","xmin","min","xmax","strokeStyle","strokeRect","moveTo","lineTo","stroke","arc","PI","_updateRenderDimensions","_updateSelectionMatrix","_updateCanvasSize","_renderRects","_renderLabels","_renderSelection","_renderCrosshair","dashboard","formatDate","evt","isExternal","time","body","duration","humanize","pageX","pageY","pos","panelRelY","window","innerHeight","clearTT","scrollTop","pX","left","$tooltip","html","place_tt","infos","selectedIndex","Number","isInteger","Error","_getCurrentTimeFormatted","items","_isTooltipOrderReversed","reverse","each","info","seriesName","count","points","Array","isArray","stats","isNumber","map","parseFloat","isNull","isNil","isString","toString","has","colorMap","_colorsPaleteCash","c","letters","split","floor","random","datasource","targets","when","scopedVars","Object","assign","interval","intervalMs","rangeRaw","raw","expandFromQueryS","clone","subtract","format","metricsQuery","panelId","id","renderer","maxDataPoints","resolution","cacheTimeout","query","dataList","type","columns","last","res","add","formatValue","finish","target","datapoints","index","indexOf","splice","cm","m","render","what","randomColor","rangeMap","values","dec","per","valueFormats","percentunit","join","event","item","showLegendTooltip","clamp","selected","showTT","hoverPoint","_showSelectionTooltip","_getRowsToHover","js","hovers","hover","_showTimelineTooltips","_showStackedTooltips","where","pt","utc","timeSrv","setTime","_clear","emit","_panelPath","panels","settings","thisPanel","pluginId","baseUrl","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import { CanvasPanelCtrl } from './canvas-panel';\nimport { DistinctPoints } from './distinct-points';\nimport { mobileAndTabletcheck, grafanaColors } from './tools';\n\nimport config from 'app/core/config';\nimport appEvents from 'app/core/app_events';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport moment from 'moment';\nimport angular from 'angular';\n\nimport './style.css!'\n\n\nclass DiscretePanelCtrl extends CanvasPanelCtrl {\n\n  constructor($scope, $injector, $q) {\n    super($scope, $injector, $q);\n\n    this.data = null;\n\n    // Set and populate defaults\n    var panelDefaults = {\n      display: 'timeline',\n      rowHeight: 40,\n      rowMargin: 1,\n      valueMaps: [\n        { value: 'null', op: '=', text: 'N/A' }\n      ],\n      mappingTypes: [\n        { name: 'value to text', value: 1 },\n        { name: 'range to text', value: 2 },\n      ],\n      rangeMaps: [\n        { from: 'null', to: 'null', text: 'N/A' }\n      ],\n      colorMaps: [\n        { text: 'N/A', color: '#CCC' }\n      ],\n      tooltip: {\n        highlightOnMouseover: true,\n        shared: true,\n        sort: 0\n      },\n      legend: {\n        show: true,\n        showPercent: false,\n        showNames: true,\n        showValues: true,\n        showTransitionCount: false,\n        showDistinctCount: false,\n        showCounts: false,\n        showTime: false,\n        sortBy: '-ms',\n        layoutMode: 'sequence',\n        percentDecimals: undefined,\n        textSize: 13\n      },\n      metricNameColor: '#000000',\n      valueTextColor: '#000000',\n      backgroundColor: 'rgba(128, 128, 128, 0.1)',\n      lineColor: 'rgba(128, 128, 128, 1.0)',\n      crosshairColor: 'rgba(170, 0, 0, 0.80)', // see jquery.flot.crosshair.js\n      textSize: 12,\n      textPadding: 4,\n      writeLastValue: true,\n      writeAllValues: false,\n      writeMetricNames: false\n    };\n\n    _.defaultsDeep(this.panel, panelDefaults);\n    this.externalPT = false;\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('refresh', this.onRefresh.bind(this));\n\n    this.updateColorInfo();\n    this.onConfigChanged();\n    this.initStyles();\n  }\n  \n  initStyles() {\n    if(mobileAndTabletcheck()) {\n      System.import(this.panelPath + 'navbarfix.css!');\n    }\n  }\n  \n  onDataError(err) {\n    console.log(\"onDataError\", err);\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options',  this.panelPath + 'editor.options.html', 1);\n    this.addEditorTab('Legend',   this.panelPath + 'editor.legend.html', 3);\n    this.addEditorTab('Colors',   this.panelPath + 'editor.colors.html', 4);\n    this.addEditorTab('Mappings', this.panelPath + 'editor.mappings.html', 5);\n    this.editorTabIndex = 1;\n    this.refresh();\n  }\n  \n  get panelPath() {\n    if(!this._panelPath) {\n      var panels = window['grafanaBootData'].settings.panels;\n      var thisPanel = panels[this.pluginId];\n      // the system loader preprends publib to the url,\n      // add a .. to go back one level\n      this._panelPath = '../' + thisPanel.baseUrl + '/';\n    }\n    return this._panelPath;\n  }\n\n  _drawUnselectRect(x, y, w, h) {\n    var ctx = this.context;\n    var tempComposition = ctx.globalCompositeOperation;\n    var tempFillStyle = ctx.fillStyle;\n\n    ctx.globalCompositeOperation = 'destination-out';\n    ctx.fillStyle = \"rgba(255, 255, 255, 0.5)\";\n    ctx.beginPath();\n    ctx.fillRect(x, y, w, h);\n    ctx.fill();\n\n    ctx.fillStyle = tempFillStyle;\n    ctx.globalCompositeOperation = tempComposition;\n  }\n\n  _updateRenderDimensions() {\n    this._renderDimenstions = { };\n\n    var rect = this._renderDimenstions.rect = this.wrap.getBoundingClientRect();\n    var rows = this._renderDimenstions.rows = this.data.length;\n    var rowHeight = this._renderDimenstions.rowHeight = this.panel.rowHeight;\n    var height = this._renderDimenstions.height = rowHeight * rows - this.panel.rowMargin;\n    var width = this._renderDimenstions.width = rect.width;\n    var rectHeight = this._renderDimenstions.rectHeight = rowHeight - this.panel.rowMargin;\n\n    var top = 0;\n    var elapsed = this.range.to - this.range.from;\n\n    this._renderDimenstions.matrix = [];\n    _.forEach(this.data, metric => {\n      var positions = [];\n\n      if(this.isTimeline) {\n        var lastBS = 0;\n        var point = metric.changes[0];\n        for(var i = 0; i < metric.changes.length; i++) {\n          point = metric.changes[i];\n          if(point.start <= this.range.to) {\n            var xt = Math.max(point.start - this.range.from, 0);\n            var x = (xt / elapsed) * width;\n            positions.push(x);\n          }\n        }\n      }\n      \n      if(this.isStacked) {\n        var point = null;\n        var start = this.range.from;\n        for(var i = 0; i < metric.legendInfo.length; i++) {\n          point = metric.legendInfo[i];\n          var xt = Math.max(start - this.range.from, 0);\n          var x = (xt / elapsed) * width;\n          positions.push(x);\n          start += point.ms;\n        }\n      }\n\n      this._renderDimenstions.matrix.push({\n        y: top,\n        positions: positions\n      });\n\n      top += rowHeight;\n    });\n  }\n\n  _updateSelectionMatrix() {\n    var selectionPredicates = {\n      all: function() { return true; },\n      crosshairHover: function(i, j) {\n        if(j + 1 === this.data[i].changes.length) {\n          return this.data[i].changes[j].start <= this.mouse.position.ts;\n        }\n        return this.data[i].changes[j].start <= this.mouse.position.ts &&\n               this.mouse.position.ts < this.data[i].changes[j + 1].start;\n      },\n      mouseX: function(i, j) {\n        var row = this._renderDimenstions.matrix[i];\n        if(j + 1 === row.positions.length) {\n          return row.positions[j] <= this.mouse.position.x;\n        }\n        return row.positions[j] <= this.mouse.position.x &&\n               this.mouse.position.x < row.positions[j + 1];\n      },\n      metric: function(i) {\n        return this.data[i] === this._selectedMetric;\n      },\n      legendItem: function(i, j) {\n        if(this.data[i] !== this._selectedMetric) {\n          return false;\n        }\n        return this._selectedLegendItem.val === this._getVal(i, j);\n      }\n    };\n\n    function getPridicate() {\n      if(this._selectedLegendItem !== undefined) {\n        return 'legendItem';\n      };\n      if(this._selectedMetric !== undefined) {\n        return 'metric';\n      };\n      if(this.mouse.down !== null) {\n        return 'all';  \n      }\n      if(this.panel.tooltip.highlightOnMouseover && this.mouse.position != null) {\n        if(this.isTimeline) {\n          return 'crosshairHover';\n        }\n        if(this.isStacked) {\n          return 'mouseX';\n        }\n      }\n      return 'all';\n    }\n\n    var pn = getPridicate.bind(this)();\n    var predicate = selectionPredicates[pn].bind(this);\n    this._selectionMatrix = [];\n    for(var i = 0; i < this._renderDimenstions.matrix.length; i++) {\n      var rs = [];\n      var r = this._renderDimenstions.matrix[i];\n      for(var j = 0; j < r.positions.length; j++) {\n        rs.push(predicate(i, j));\n      }\n      this._selectionMatrix.push(rs);\n    }\n  }\n\n  _getVal(metricIndex, rectIndex) {\n    var point = undefined;\n    if(this.isTimeline) { point = this.data[metricIndex].changes[rectIndex]; }\n    if(this.isStacked) { point = this.data[metricIndex].legendInfo[rectIndex]; }\n    return point.val;\n  }\n\n  _getWidth(metricIndex, rectIndex) {\n    var positions = this._renderDimenstions.matrix[metricIndex].positions;\n    if(rectIndex + 1 === positions.length) {\n      return this._renderDimenstions.width - positions[rectIndex];\n    }\n    return positions[rectIndex + 1] - positions[rectIndex];\n  }\n\n  _updateCanvasSize() {\n    this.canvas.width = this._renderDimenstions.width * this._devicePixelRatio;\n    this.canvas.height = this._renderDimenstions.height * this._devicePixelRatio;\n\n    $(this.canvas).css('width', this._renderDimenstions.width + 'px');\n    $(this.canvas).css('height', this._renderDimenstions.height + 'px');\n\n    this.context.scale(this._devicePixelRatio, this._devicePixelRatio);\n  }\n\n  _renderRects() {\n    var matrix = this._renderDimenstions.matrix;\n    var ctx = this.context;\n    _.forEach(this.data, (metric, i) => {\n      var rowObj = matrix[i];\n      for(var j = 0; j < rowObj.positions.length; j++) {\n        var currentX = rowObj.positions[j];\n        var nextX = this._renderDimenstions.width;\n        if(j + 1 !== rowObj.positions.length) {\n          nextX = rowObj.positions[j + 1];\n        }\n        ctx.fillStyle = this.getColor(this._getVal(i, j));\n        var globalAlphaTemp = ctx.globalAlpha;\n        if(!this._selectionMatrix[i][j]) {\n          ctx.globalAlpha = 0.3;\n        }\n        ctx.fillRect(\n          currentX, matrix[i].y,\n          nextX - currentX, this._renderDimenstions.rectHeight\n        );\n        ctx.globalAlpha = globalAlphaTemp;\n      }\n    });\n  }\n\n  _renderLabels() {\n\n    const LEBELS_PADDING = this.panel.textPadding;\n    var ctx = this.context;\n    ctx.lineWidth = 1;\n    ctx.textBaseline = 'middle';\n    ctx.font = this.panel.textSize + 'px \"Open Sans\", Helvetica, Arial, sans-serif';\n\n    function findLength(text, width) {\n      var length = 1;\n      for(; length < text.length + 1; length++) {\n        var testLine = text.substr(0, length);\n        var measure = ctx.measureText(testLine);\n        if(measure.width > width) {\n          break;\n        }\n      }\n\n      return text.substr(0, length - 1);\n    }\n\n    _.forEach(this.data, (metric, i) => {\n      var { y, positions } = this._renderDimenstions.matrix[i];\n      var rectHeight = this._renderDimenstions.rectHeight;\n\n      var centerV = y + (rectHeight / 2);\n      var labelPositionMetricName = y + rectHeight - this.panel.textSize / 2 - LEBELS_PADDING;\n      var labelPositionLastValue  = y + rectHeight - this.panel.textSize / 2 - LEBELS_PADDING;\n      var labelPositionValue      = y + this.panel.textSize / 2 + LEBELS_PADDING;\n\n      if(this.mouse.position == null) {\n        if(this.panel.writeMetricNames) {\n          ctx.fillStyle = this.panel.metricNameColor;\n          ctx.textAlign = 'left';\n          ctx.fillText(metric.name, LEBELS_PADDING, labelPositionMetricName);\n        }\n        if(this.panel.writeLastValue) {\n          var val = this._getVal(i, positions.length - 1);\n          ctx.fillStyle = this.panel.valueTextColor;\n          ctx.textAlign = 'right';\n          ctx.fillText(val, this._renderDimenstions.width - LEBELS_PADDING, labelPositionLastValue);\n        }\n      }\n      \n      ctx.fillStyle = this.panel.valueTextColor;\n      ctx.textAlign = 'left';\n      for(var j = 0; j < positions.length; j++) {\n        var val = this._getVal(i, j);\n        var width = this._getWidth(i, j);\n        var cval = findLength(val, width - LEBELS_PADDING * 2);\n        ctx.fillText(cval, positions[j] + LEBELS_PADDING, labelPositionValue);\n      }\n\n    });\n\n  }\n\n  _renderSelection() {\n    if(this.mouse.down === null) {\n      return;\n    }\n    if(this.mouse.position === null) {\n      return;\n    }\n    if(!this.isTimeline) {\n      return;\n    }\n\n    var ctx = this.context;\n    var height = this._renderDimenstions.height;\n\n    var xmin = Math.min(this.mouse.position.x, this.mouse.down.x);\n    var xmax = Math.max(this.mouse.position.x, this.mouse.down.x);\n\n    ctx.fillStyle = \"rgba(110, 110, 110, 0.5)\";\n    ctx.strokeStyle=\"rgba(110, 110, 110, 0.5)\";\n    ctx.beginPath();\n    ctx.fillRect(xmin, 0, xmax - xmin, height);\n    ctx.strokeRect(xmin, 0, xmax - xmin, height);\n  }\n\n  _renderCrosshair() {\n    if(this.mouse.down != null) {\n      return;\n    }\n    if(this.mouse.position === null) {\n      return;\n    }\n    if(!this.isTimeline) {\n      return;\n    }\n\n    var ctx = this.context;\n    var rows = this.data.length;\n    var rowHeight = this.panel.rowHeight;\n    var height = this._renderDimenstions.height;\n\n    ctx.beginPath();\n    ctx.moveTo(this.mouse.position.x, 0);\n    ctx.lineTo(this.mouse.position.x, height);\n    ctx.strokeStyle = this.panel.crosshairColor;\n    ctx.lineWidth = 1;\n    ctx.stroke();\n\n    if(this.externalPT && rows > 1) {\n      ctx.beginPath();\n      ctx.arc(this.mouse.position.x, this.mouse.position.y, 3, 0, 2 * Math.PI, false);\n      ctx.fillStyle = this.panel.crosshairColor;\n      ctx.fill();\n      ctx.lineWidth = 1;\n    } \n  }\n\n  onRender() {\n    if(this.data == null || !(this.context)) {\n      return;\n    }\n    this._updateRenderDimensions();\n    this._updateSelectionMatrix();\n    this._updateCanvasSize();\n    this._renderRects();\n    this._renderLabels();\n    this._renderSelection();\n    this._renderCrosshair();\n  }\n\n  get _isTooltipOrderReversed() {\n    return this.panel.tooltip.sort === 2;\n  }\n\n  _getCurrentTimeFormatted() {\n    // Format might be idfferent \n    // see https://github.com/grafana/grafana/blob/32f9a42d5e931be549ff9f169468b404af9a6b21/public/app/plugins/panel/graph/graph_tooltip.js#L212\n    return this.dashboard.formatDate(moment(this.mouse.position.ts), 'YYYY-MM-DD HH:mm:ss.SSS');\n  }\n\n  _showSelectionTooltip(evt, point, isExternal) {\n    \n    var from = point.start;\n    var to = point.start + point.ms;\n    var time = point.ms;\n    var val = point.val;\n\n    var body = '<div class=\"graph-tooltip-time\">' + val + '</div>';\n\n    body += \"<center>\"\n    body += this.dashboard.formatDate(moment(from));\n    body += \" to \";\n    body += this.dashboard.formatDate(moment(to));\n    body += \" (\" + moment.duration(time).humanize() + \")\";\n    body += \"</center>\"\n    \n    var pageX = 0;\n    var pageY = 0;\n    if(isExternal) {\n      var rect = this.canvas.getBoundingClientRect();\n      pageY = rect.top + (evt.pos.panelRelY * rect.height);\n      if(pageY < 0 || pageY > $(window).innerHeight()) {\n        // Skip Hidden tooltip\n        this.clearTT();\n        return;\n      }\n      pageY += $(window).scrollTop();\n\n      var elapsed = this.range.to - this.range.from;\n      var pX = (evt.pos.x - this.range.from) / elapsed;\n      pageX = rect.left + (pX * rect.width);\n    } else {\n      pageX = evt.evt.pageX;\n      pageY = evt.evt.pageY;\n    }\n\n    this.$tooltip.html(body).place_tt(pageX + 20, pageY + 5);\n  };\n\n  _showStackedTooltips(pos, infos, selectedIndex) {\n\n    if(!Number.isInteger(selectedIndex)) {\n      throw new Error('selectedIndex must integer');\n    }\n\n    var body = `<div class=\"graph-tooltip-time\"> ${this._getCurrentTimeFormatted()} </div>`;\n\n    var items = infos;\n    if(this._isTooltipOrderReversed) {\n      _.reverse(items);\n    }\n    _.each(items, (info, i) => {\n\n      var color = this.getColor(info.val);\n      var seriesName = this.data[i].name;\n\n      body += `\n      <div \n        class=\"\n          graph-tooltip-list-item \n          ${i == selectedIndex ? 'graph-tooltip-list-item--highlight' : ''}\n        \"\n      >\n        <div class=\"graph-tooltip-series-name\">\n          <i class=\"fa fa-minus\" style=\"color:${color}\"></i>\n          ${seriesName}: ${info.val}\n          (${info.count})\n        </div>\n        <div class=\"graph-tooltip-value\">\n          ${moment.duration(info.ms).humanize()}\n        </div>\n      </div>\n      `;\n    });\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  _showTimelineTooltips(evt, points, selectedIndex, isExternal) {\n\n    if(!Array.isArray(points)) {\n      throw new Error('Not array provided');\n    }\n\n    if(!Number.isInteger(selectedIndex)) {\n      throw new Error('selectedIndex must be integer');\n    }\n\n    var body = `<div class=\"graph-tooltip-time\"> ${this._getCurrentTimeFormatted()} </div>`;\n\n    var items = points;\n    if(this._isTooltipOrderReversed) {\n      _.reverse(items);\n    }\n\n    _.each(items, (point, i) => {\n\n      var from = point.start;\n      var to = point.start + point.ms;\n      var time = point.ms;\n      var val = point.val;\n      if(this.panel.tooltip.shared) {\n        var seriesName = this.data[i].name;\n      } else {\n        var seriesName = this.data[selectedIndex].name;\n      }\n\n      var color = this.getColor(val);\n\n      body += `\n      <div \n        class=\"\n          graph-tooltip-list-item \n          ${(i == selectedIndex) || !this.panel.tooltip.shared ? 'graph-tooltip-list-item--highlight' : ''}\n        \"\n      >\n        <div class=\"graph-tooltip-series-name\">\n          <i class=\"fa fa-minus\" style=\"color:${color}\"></i>\n          ${seriesName}: ${val}\n        </div>\n        <div class=\"graph-tooltip-value\">\n          ${this.dashboard.formatDate(moment(from))}\n          to\n          ${this.dashboard.formatDate(moment(to))}\n          (${moment.duration(time).humanize()});\n        </div>\n      </div>\n      `;\n    });\n    \n    var pageX = 0;\n    var pageY = 0;\n    if(isExternal) {\n      var rect = this.canvas.getBoundingClientRect();\n      pageY = rect.top + (evt.pos.panelRelY * rect.height);\n      if(pageY < 0 || pageY > $(window).innerHeight()) {\n        // Skip Hidden tooltip\n        this.clearTT();\n        return;\n      }\n      pageY += $(window).scrollTop();\n\n      var elapsed = this.range.to - this.range.from;\n      var pX = (evt.pos.x - this.range.from) / elapsed;\n      pageX = rect.left + (pX * rect.width);\n    } else {\n      pageX = evt.evt.pageX;\n      pageY = evt.evt.pageY;\n    }\n\n    this.$tooltip.html(body).place_tt(pageX + 20, pageY + 5);\n\n  }\n\n  showLegendTooltip(pos, info) {\n    var body = '<div class=\"graph-tooltip-time\">'+ info.val +'</div>';\n\n    body += \"<center>\";\n    if(info.count > 1) {\n      body += info.count + \" times<br/>\";\n    }\n    body += moment.duration(info.ms).humanize();\n    if(info.count > 1) {\n      body += \" total\";\n    }\n    body += \"</center>\"\n\n    this.$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  }\n\n  formatValue(val, stats) {\n\n    if(_.isNumber(val) && this.panel.rangeMaps) {\n      for (var i = 0; i < this.panel.rangeMaps.length; i++) {\n        var map = this.panel.rangeMaps[i];\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= val && from <= val) {\n          return map.text;\n        }\n      }\n    }\n\n    var isNull = _.isNil(val);\n    if(!isNull && !_.isString(val)) {\n      val = val.toString(); // convert everything to a string\n    }\n\n    for (var i = 0; i < this.panel.valueMaps.length; i++) {\n      var map = this.panel.valueMaps[i];\n      // special null case\n      if (map.value === 'null') {\n        if (isNull) {\n          return map.text;\n        }\n        continue;\n      }\n\n      if(val == map.value) {\n        return map.text;\n      }\n    }\n\n    if(isNull) {\n      return \"null\";\n    }\n    return val;\n  }\n\n  getColor(val) {\n    if(_.has(this.colorMap, val)) {\n      return this.colorMap[val];\n    }\n    if(this._colorsPaleteCash[val] === undefined) {\n      var c = grafanaColors[this._colorsPaleteCash.length % grafanaColors.length];\n      this._colorsPaleteCash[val] = c;\n      this._colorsPaleteCash.length++;\n    }\n    return this._colorsPaleteCash[val];\n  }\n\n  randomColor() {\n    var letters = 'ABCDE'.split('');\n    var color = '#';\n    for (var i = 0; i < 3; i++) {\n      color += letters[Math.floor(Math.random() * letters.length)];\n    }\n    return color;\n  }\n\n  // Copied from Metrics Panel, only used to expand the 'from' query\n  issueQueries(datasource) {\n    this.datasource = datasource;\n\n    if (!this.panel.targets || this.panel.targets.length === 0) {\n      return this.$q.when([]);\n    }\n\n    // make shallow copy of scoped vars,\n    // and add built in variables interval and interval_ms\n    var scopedVars = Object.assign({}, this.panel.scopedVars, {\n      \"__interval\":     {text: this.interval,   value: this.interval},\n      \"__interval_ms\":  {text: this.intervalMs, value: this.intervalMs},\n    });\n\n    var range = this.range;\n    var rangeRaw = this.rangeRaw || this.range.raw;\n    if(this.panel.expandFromQueryS > 0) {\n      range = {\n        from: this.range.from.clone(),\n        to: this.range.to\n      };\n      range.from.subtract( this.panel.expandFromQueryS, 's' );\n\n      rangeRaw = {\n        from: range.from.format(),\n        to: rangeRaw.to\n      };\n      range.raw = rangeRaw;\n    }\n\n    var metricsQuery = {\n      panelId: this.panel.id,\n      range: range,\n      rangeRaw: rangeRaw,\n      interval: this.interval,\n      intervalMs: this.intervalMs,\n      targets: this.panel.targets,\n      format: this.panel.renderer === 'png' ? 'png' : 'json',\n      maxDataPoints: this.resolution,\n      scopedVars: scopedVars,\n      cacheTimeout: this.panel.cacheTimeout\n    };\n\n    return datasource.query(metricsQuery);\n  }\n\n  onDataReceived(dataList) {\n    $(this.canvas).css('cursor', 'pointer');\n\n    var data = [];\n    _.forEach(dataList, metric => {\n      if(metric.type === 'table') {\n        if(metric.columns[0].type !== 'time') {\n          throw 'Expected a time column from the table format';\n        }\n        var last = null;\n        for(var i = 1; i < metric.columns.length; i++) {\n          var res = new DistinctPoints(metric.columns[i].text);\n          for(var j = 0; j < metric.rows.length; j++) {\n            var row = metric.rows[j];\n            res.add(row[0], this.formatValue(row[i]));\n          }\n          res.finish(this);\n          data.push(res);\n        }\n      } else {\n        var res = new DistinctPoints(metric.target);\n        _.forEach(metric.datapoints, point => {\n          res.add(point[1], this.formatValue(point[0]));\n        });\n        res.finish(this);\n        data.push(res);\n      }\n    });\n    this.data = data;\n\n    this.onRender();\n  }\n\n  removeColorMap(map) {\n    var index = _.indexOf(this.panel.colorMaps, map);\n    this.panel.colorMaps.splice(index, 1);\n    this.updateColorInfo();\n  };\n\n  updateColorInfo() {\n    var cm = {};\n    for(var i = 0; i < this.panel.colorMaps.length; i++) {\n      var m = this.panel.colorMaps[i];\n      if(m.text) {\n        cm[m.text] = m.color;\n      }\n    }\n    this.colorMap = cm;\n\n    this._colorsPaleteCash = {};\n    this._colorsPaleteCash.length = 0;\n    this.render();\n  }\n\n  addColorMap(what) {\n    if(what == 'curent') {\n      _.forEach(this.data, (metric) => {\n        if(metric.legendInfo) {\n          _.forEach(metric.legendInfo, info => {\n            if(!_.has(info.val)) {\n              this.panel.colorMaps.push({text: info.val, color: this.getColor(info.val) });\n            }\n          });\n        }\n      });\n    }\n    else {\n      this.panel.colorMaps.push({text: '???', color: this.randomColor() });\n    }\n    this.updateColorInfo();\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  };\n\n  addValueMap() {\n    this.panel.valueMaps.push({value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  };\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({ from:'', to: '', text:'' });\n  }\n\n  onConfigChanged() {\n    this.isTimeline = this.panel.display == 'timeline';\n    this.isStacked = this.panel.display == 'stacked';\n    this.render();\n  }\n\n  getLegendDisplay(info, metric) {\n    var values = [];\n\n    if(this.panel.legend.showTime) {\n      values.push(moment.duration(info.ms).humanize());\n    }\n\n    if(this.panel.legend.showCounts) {\n      values.push(info.count + \"x\");\n    }\n    \n    if(this.panel.legend.showPercent) {\n      var dec = this.panel.legend.percentDecimals;\n      if(_.isNil(dec)) {\n        if(info.per > .98 && metric.changes.length > 1) {\n          dec = 2;\n        } else if(info.per < 0.02) {\n          dec = 2;\n        } else {\n          dec = 0;\n        }\n      }\n      values.push(kbn.valueFormats.percentunit(info.per, dec));\n    }\n\n    if(values.length !== 0) {\n      return info.val + ` (${values.join(', ')})`;\n    } else {\n      return info.val;\n    }\n      \n    \n  }\n\n  selectLegendMetric(event, metric) {\n    this._selectedMetric = metric;\n    this.render();\n  }\n\n  selectLegendItem(event, item, metric) {\n    this.showLegendTooltip(event, item);\n    this._selectedMetric = metric;\n    this._selectedLegendItem = item;\n    this.render();\n  }\n\n  deselectLegend() {\n    this._selectedMetric = undefined;\n    this._selectedLegendItem = undefined;\n    this.clearTT();\n    this.render();\n  }\n\n  //------------------\n  // Mouse Events\n  //------------------\n\n  _getRowsToHover() {\n    var j = Math.floor(this.mouse.position.y / this.panel.rowHeight);\n    j = _.clamp(j, 0, this.data.length - 1);\n    var res = {\n      items: undefined,\n      selected: undefined\n    };\n\n    if(this.panel.tooltip.shared) {\n      res.items = _.range(0, this.data.length);\n      res.selected = j;\n    } else {\n      res.items = [j];\n      res.selected = j;\n    }\n\n    return res;\n  }\n\n  onGraphHover(evt, showTT, isExternal) {\n    this.externalPT = isExternal;\n    if(!this.data) {\n      this.clearTT();\n      this.onRender();\n      return;\n    }\n\n    if(this.mouse.down != null) {\n      var from = Math.min(this.mouse.down.ts, this.mouse.position.ts);\n      var to   = Math.max(this.mouse.down.ts, this.mouse.position.ts);\n      var time = to - from;\n      this.hoverPoint = { start: from, ms: time, val: \"Zoom To:\" };\n\n      this._showSelectionTooltip(evt, this.hoverPoint, isExternal);\n      this.onRender();\n      return;\n    }\n\n    if(!showTT) {\n      this.onRender();\n      return;\n    }\n    \n    var { items: js, selected } = this._getRowsToHover();\n    \n    // TODO: use this._renderDimenstions for optimozation\n    if(this.isTimeline) {\n      var hovers = [];\n      _.each(js, j => {\n        var hover = this.data[j].changes[0];\n        for(var i = 0; i < this.data[j].changes.length; i++) {\n          if(this.data[j].changes[i].start > this.mouse.position.ts) {\n            break;\n          }\n          hover = this.data[j].changes[i];\n        }\n        hovers.push(hover);\n      });\n      \n      this._showTimelineTooltips(evt, hovers, selected, isExternal);\n      this.onRender();\n      return;\n    }\n\n    if(!isExternal && this.panel.display == 'stacked') {\n      var hovers = [];\n      _.each(js, j => {\n        var hover = this.data[j].legendInfo[0];\n        for(var i = 0; i < this.data[j].legendInfo.length; i++) {\n          if(this.data[j].legendInfo[i].x > this.mouse.position.x) {\n            break;\n          }\n          hover = this.data[j].legendInfo[i];\n        }\n        hovers.push(hover);\n      });\n\n      this._showStackedTooltips(evt.evt, hovers, selected);\n      this.onRender();\n      return;\n    }\n\n  }\n\n  onMouseClicked(where) {\n    var pt = this.hoverPoint;\n    if(pt && pt.start) {\n      var range = { from: moment.utc(pt.start), to: moment.utc(pt.start + pt.ms) };\n      this.timeSrv.setTime(range);\n      this._clear();\n    }\n  }\n\n  onMouseSelectedRange(range) {\n    this.timeSrv.setTime(range);\n    this._clear();\n  }\n\n  _clear() {\n    this.hoverPoint = null;\n    this.mouse.position = null;\n    this.mouse.down = null;\n    $(this.canvas).css('cursor', 'wait');\n    appEvents.emit('graph-hover-clear');\n    this.render();\n  }\n}\n\nDiscretePanelCtrl.templateUrl = 'module.html';\n\nexport { DiscretePanelCtrl as PanelCtrl };\n\n\n"]}